<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
<h:head>
    <title>RecetasWeb - Plataforma Colaborativa de Recetas</title>
    <!-- Usamos la √∫ltima versi√≥n de PrimeFlex -->
    <link rel="stylesheet" href="https://unpkg.com/primeflex@latest/primeflex.css"/>
    <style>
        /* Mantenemos los degradados personalizados ya que PrimeFlex no los incluye directamente */
        .hero-section {
            background: linear-gradient(135deg, #ff6b6b, #ffa726);
        }
        .stats-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }
        /* Y los estilos de hover para el chip de categor√≠a */
        .category-chip {
            transition: all 0.2s;
            cursor: pointer;
        }
        .category-chip:hover {
            background-color: #1976d2;
            color: white;
        }
        /* Clase a√±adida para mejorar la legibilidad del texto blanco */
        .text-shadow-subtle {
            text-shadow: 2px 2px 6px rgba(0, 0, 0, 0.7);
        }
    </style>
</h:head>
<h:body>
    <ui:composition template="/plantilla.xhtml">
        <ui:define name="content">
            <!-- Usamos flexbox para el contenedor principal -->
            <div class="flex flex-column gap-5">
                <!-- Secci√≥n de bienvenida con clases de PrimeFlex -->
                <div class="hero-section text-center p-5 border-round-2xl">
                    <!-- Sombra aplicada al t√≠tulo principal -->
                    <h1 class="text-6xl font-bold mb-3 text-shadow-subtle text-blue-900">üç≥ RecetasWeb - Gestion Moderador</h1>
                </div>

                <div class="surface-card p-4 border-round-2xl">
                    <h:form id="formulario-recetas">
                        <p:growl id="mensaje-emergente" showDetail="true" />
                        <div>
                            <div class="surface-card p-4 border-round-2xl">
                                <div class="flex align-items-center justify-content-between mb-4">
                                    <h2 class="text-2xl font-bold">üìö Gestion de Recetas</h2>
                                    <div class="flex gap-2">
                                        <p:commandButton icon="pi pi-refresh"
                                                         title="Refrescar lista" />
                                    </div>
                                </div>

                                <p:dataTable id="tabla-recetas"
                                             var="receta"
                                             value="#{recetaController.recetas}"
                                             emptyMessage="No hay recetas disponibles. ¬°S√© el primero en crear una!"
                                             styleClass="p-datatable-sm p-datatable-striped"
                                             paginator="true"
                                             rows="10"
                                             paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                             rowsPerPageTemplate="5,10,15">

                                    <p:column headerText="üìù Receta" sortBy="#{receta.tituloReceta}">
                                        <div>
                                            <h:outputText value="#{receta.tituloReceta}" styleClass="font-bold text-lg" />
                                            <br/>
                                            <small class="text-500">
                                                Por: #{receta.usuario.nombreUsuario}
                                            </small>
                                        </div>
                                    </p:column>

                                    <p:column headerText="ü•ò Ingredientes" width="200">
                                        <h:outputText value="#{receta.ingredientes}" />
                                    </p:column>

                                    <p:column headerText="‚è±Ô∏è Tiempo" sortBy="#{receta.tiempoPreparacion}" width="100">
                                        <div class="text-center">
                                            <span class="font-bold">#{receta.tiempoPreparacion}</span>
                                            <br/>
                                            <small class="text-500">minutos</small>
                                        </div>
                                    </p:column>

                                    <p:column headerText="üîß Acciones" width="150">
                                        <div class="flex gap-1 justify-content-center">
                                            <p:commandButton icon="pi pi-pencil"
                                                             title="Editar"
                                                             oncomplete="PF('ventanaModalReceta').show()"
                                                             action="#{recetaController.setRecetaSeleccionada(receta)}"
                                                             update=":dialog-receta-form"
                                                             styleClass="p-button-rounded p-button-info p-button-sm" />
                                            <p:commandButton icon="pi pi-trash"
                                                             title="Eliminar"
                                                             oncomplete="PF('ventanaModalEliminar').show()"
                                                             action="#{recetaController.setRecetaSeleccionada(receta)}"
                                                             styleClass="p-button-rounded p-button-danger p-button-sm" />
                                            <p:commandButton icon="pi pi-star"
                                                             title="Calificar"
                                                             oncomplete="PF('ventanaModalCalificar').show()"
                                                             action="#{calificacionController.prepararCalificacion(receta)}"
                                                             update=":dialog-calificar-form"
                                                             styleClass="p-button-rounded p-button-warning p-button-sm" />
                                        </div>
                                    </p:column>
                                </p:dataTable>
                            </div>
                        </div>
                    </h:form>
                </div>
            </div>

            <h:form id="dialog-receta-form">
                <p:dialog header="#{recetaController.recetaSeleccionada.idReceta == null ? '‚ûï Nueva Receta' : '‚úèÔ∏è Editar Receta'}"
                          widgetVar="ventanaModalReceta"
                          modal="true"
                          responsive="true"
                          width="80%"
                          styleClass="p-fluid">
                    <p:tabView>
                        <p:tab title="üìù Informaci√≥n B√°sica">
                            <div class="flex flex-column gap-3">
                                <div>
                                    <div class="p-field">
                                        <span class="p-float-label">
                                            <p:inputText id="titulo"
                                                         value="#{recetaController.recetaSeleccionada.tituloReceta}"
                                                         required="true"
                                                         styleClass="p-input-filled" />
                                            <label for="titulo">üè∑Ô∏è T√≠tulo de la Receta</label>
                                        </span>
                                        <p:message for="titulo" />
                                    </div>
                                </div>
                                <!-- Campo para ingresar la URL de la imagen -->
                                <div>
                                    <div class="p-field">
                                        <span class="p-float-label">
                                            <p:inputText id="urlImagen"
                                                         value="#{recetaController.recetaSeleccionada.urlImagen}"
                                                         styleClass="p-input-filled" />
                                            <label for="urlImagen">üñºÔ∏è URL de la Imagen</label>
                                        </span>
                                        <p:message for="urlImagen" />
                                    </div>
                                </div>

                            </div>
                        </p:tab>

                        <p:tab title="ü•ò Ingredientes">
                            <div class="p-field">
                                <span class="p-float-label">
                                    <p:inputTextarea id="ingredientes"
                                                     value="#{recetaController.recetaSeleccionada.ingredientes}"
                                                     rows="6"
                                                     required="true"
                                                     styleClass="p-input-filled" />
                                    <label for="ingredientes">üìã Lista de Ingredientes (uno por l√≠nea)</label>
                                </span>
                                <p:message for="ingredientes" />
                            </div>
                        </p:tab>

                        <p:tab title="‚öôÔ∏è Detalles">
                            <div class="flex flex-column gap-3">
                                <div>
                                    <div class="p-field">
                                        <span class="p-float-label">
                                            <p:inputNumber id="tiempo"
                                                           value="#{recetaController.recetaSeleccionada.tiempoPreparacion}"
                                                           required="true"
                                                           styleClass="p-input-filled" />
                                            <label for="tiempo">‚è±Ô∏è Tiempo (minutos)</label>
                                        </span>
                                        <p:message for="tiempo" />
                                    </div>
                                </div>
                            </div>
                        </p:tab>
                    </p:tabView>

                    <f:facet name="footer">
                        <div class="flex justify-content-end gap-2">
                            <p:commandButton value="üíæ Guardar"
                                             action="#{recetaController.guardarReceta}"
                                             oncomplete="if (!args.validationFailed) PF('ventanaModalReceta').hide()"
                                             update="dialog-receta-form :formulario-recetas:mensaje-emergente :formulario-recetas:tabla-recetas"
                                             icon="pi pi-save"
                                             styleClass="p-button-success" />
                            <p:commandButton value="‚ùå Cancelar"
                                             onclick="PF('ventanaModalReceta').hide()"
                                             type="button"
                                             icon="pi pi-times"
                                             styleClass="p-button-secondary" />
                        </div>
                    </f:facet>
                </p:dialog>
            </h:form>

            <h:form id="dialog-eliminar-form">
                <p:dialog header="üóëÔ∏è Confirmar Eliminaci√≥n"
                          widgetVar="ventanaModalEliminar"
                          modal="true"
                          responsive="true"
                          width="400px">
                    <div class="text-center">
                        <i class="pi pi-exclamation-triangle text-6xl text-orange-500 mb-3"></i>
                        <h3 class="mb-3">¬øEst√°s seguro?</h3>
                        <p class="mb-4">Esta acci√≥n eliminar√° permanentemente la receta <strong>"#{recetaController.recetaSeleccionada.tituloReceta}"</strong> y no se puede deshacer.</p>

                        <div class="flex justify-content-center gap-2">
                            <p:commandButton value="üóëÔ∏è S√≠, Eliminar"
                                             action="#{recetaController.eliminarReceta}"
                                             oncomplete="PF('ventanaModalEliminar').hide()"
                                             update=":formulario-recetas:mensaje-emergente :formulario-recetas:tabla-recetas"
                                             styleClass="p-button-danger"
                                             icon="pi pi-trash" />
                            <p:commandButton value="‚ùå Cancelar"
                                             onclick="PF('ventanaModalEliminar').hide()"
                                             type="button"
                                             styleClass="p-button-secondary"
                                             icon="pi pi-times" />
                        </div>
                    </div>
                </p:dialog>
            </h:form>

            <p:dialog header="‚≠ê Calificar Receta"
                      widgetVar="ventanaModalCalificar"
                      modal="true"
                      responsive="true"
                      width="400px">
                <h:form id="dialog-calificar-form">
                    <div class="text-center">
                        <h3 class="mb-3">#{calificacionController.recetaACalificar.tituloReceta}</h3>
                        <div class="p-field">
                            <label class="font-semibold">Tu calificaci√≥n:</label>
                            <p:rating value="#{calificacionController.calificacionSeleccionada.puntuacion}"
                                      styleClass="text-2xl my-3" />
                        </div>
                        <div class="p-field">
                            <span class="p-float-label">
                                <p:inputTextarea id="comentario-calificacion"
                                                 value="#{calificacionController.calificacionSeleccionada.comentario}"
                                                 rows="3"
                                                 styleClass="p-input-filled" />
                                <label for="comentario-calificacion">üí¨ Comentario (opcional)</label>
                            </span>
                        </div>

                        <div class="flex justify-content-center gap-2 mt-4">
                            <p:commandButton value="‚≠ê Calificar"
                                             action="#{calificacionController.guardarCalificacion}"
                                             oncomplete="if (!args.validationFailed) PF('ventanaModalCalificar').hide()"
                                             update="dialog-calificar-form :formulario-recetas:mensaje-emergente :formulario-recetas:tabla-recetas"
                                             styleClass="p-button-warning" />
                            <p:commandButton value="Cancelar"
                                             onclick="PF('ventanaModalCalificar').hide()"
                                             type="button"
                                             styleClass="p-button-secondary" />
                        </div>
                    </div>
                </h:form>
            </p:dialog>

        </ui:define>
    </ui:composition>
</h:body>
</html>

        <!--terminada vista menuPrincipal carrrusel-->
